# WebSocket to SSE Proxy

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ-–ø—Ä–æ–∫—Å–∏ –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–µ–π —Å–≤—è–∑–∏ –º–µ–∂–¥—É WebSocket-–∫–ª–∏–µ–Ω—Ç–∞–º–∏ –∏ SSE-—Å–µ—Ä–≤–µ—Ä–∞–º–∏.

## –û–ø–∏—Å–∞–Ω–∏–µ

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π:

- –ü—Ä–∏–Ω–∏–º–∞–µ—Ç WebSocket-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –æ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤
- –í—ã–ø–æ–ª–Ω—è–µ—Ç HTTP-–∑–∞–ø—Ä–æ—Å—ã –∫ SSE-—Å–µ—Ä–≤–µ—Ä–∞–º –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞
- –¢—Ä–∞–Ω—Å–ª–∏—Ä—É–µ—Ç SSE-—Å–æ–±—ã—Ç–∏—è –æ–±—Ä–∞—Ç–Ω–æ –∫–ª–∏–µ–Ω—Ç—É —á–µ—Ä–µ–∑ WebSocket –≤ JSON-—Ñ–æ—Ä–º–∞—Ç–µ
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –∑–∞–ø—Ä–æ—Å–æ–≤

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
‚îú‚îÄ‚îÄ proxy/                 # –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ-–ø—Ä–æ–∫—Å–∏
‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îú‚îÄ‚îÄ test/                  # –¢–µ—Å—Ç–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ client/           # WebSocket –∫–ª–∏–µ–Ω—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îî‚îÄ‚îÄ server/           # SSE —Å–µ—Ä–≤–µ—Ä –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
‚îÇ       ‚îî‚îÄ‚îÄ index.ts
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ tsconfig.json
‚îú‚îÄ‚îÄ settings.json         # –§–∞–π–ª –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ start-proxy.cmd       # –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ–∫—Å–∏ –¥–ª—è Windows
‚îú‚îÄ‚îÄ start-server.cmd      # –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞ SSE —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è Windows
‚îú‚îÄ‚îÄ start-client.cmd      # –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞ –¥–ª—è Windows
‚îú‚îÄ‚îÄ start-all.cmd         # –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –¥–ª—è Windows
‚îú‚îÄ‚îÄ stop-all.cmd          # –°–∫—Ä–∏–ø—Ç –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –¥–ª—è Windows
‚îú‚îÄ‚îÄ test-app.cmd          # –°–∫—Ä–∏–ø—Ç –ø–æ–ª–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ free-ports.cmd        # –°–∫—Ä–∏–ø—Ç –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è –ø–æ—Ä—Ç–æ–≤ –¥–ª—è Windows
‚îî‚îÄ‚îÄ README.md
```

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

- **Node.js** (v18+)
- **TypeScript**
- **Fastify** - –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- **@fastify/websocket** - WebSocket –ø–æ–¥–¥–µ—Ä–∂–∫–∞
- **ws** - WebSocket –±–∏–±–ª–∏–æ—Ç–µ–∫–∞

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
git clone <repository-url>
cd ws-proxy-sse
```

### 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
npm install
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞

–í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ —Ñ–∞–π–ª–µ `settings.json`:

```json
{
  "proxy": {
    "port": 3001,
    "host": "localhost"
  },
  "sseServer": {
    "port": 8081,
    "host": "localhost"
  },
  "client": {
    "message": "Hello Server!",
    "sendInterval": 1000,
    "testDuration": 10000
  }
}
```

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏:**
- **proxy** - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä–∞ (–ø–æ—Ä—Ç –∏ —Ö–æ—Å—Ç)
- **sseServer** - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ SSE-—Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- **client** - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–ª–∏–µ–Ω—Ç–∞ (—Å–æ–æ–±—â–µ–Ω–∏—è –∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã)

–í—ã –º–æ–∂–µ—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ—Ä—Ç—ã, —Å–æ–æ–±—â–µ–Ω–∏—è –∏–ª–∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –±–µ–∑ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞.

### 4. –ó–∞–ø—É—Å–∫ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

–û—Ç–∫—Ä–æ–π—Ç–µ **—Ç—Ä–∏ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ç–µ—Ä–º–∏–Ω–∞–ª–∞** –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

**–¢–µ—Ä–º–∏–Ω–∞–ª 1 - SSE –°–µ—Ä–≤–µ—Ä:**
```bash
npm run start:server
```

**–¢–µ—Ä–º–∏–Ω–∞–ª 2 - –ü—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä:**
```bash
npm run start:proxy
```

**–¢–µ—Ä–º–∏–Ω–∞–ª 3 - WebSocket –ö–ª–∏–µ–Ω—Ç:**
```bash
npm run start:client
```

### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –∑–∞–ø—É—Å–∫ (Windows)

–î–ª—è Windows –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–æ—Ç–æ–≤—ã–µ —Å–∫—Ä–∏–ø—Ç—ã:

**–ó–∞–ø—É—Å–∫ —Ç–æ–ª—å–∫–æ –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä–∞:**
```cmd
start-proxy.cmd
```

**–ó–∞–ø—É—Å–∫ –≤—Å–µ–π —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ä–µ–¥—ã (—Å–µ—Ä–≤–µ—Ä + –ø—Ä–æ–∫—Å–∏ + –∫–ª–∏–µ–Ω—Ç):**
```cmd
test-app.cmd
```

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã:**
```cmd
start-all.cmd      # –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –æ–∫–Ω–∞—Ö
stop-all.cmd       # –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
free-ports.cmd     # –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –ø–æ—Ä—Ç–æ–≤ 3001 –∏ 8081
```

## –ü—Ä–æ—Ç–æ–∫–æ–ª –æ–±–º–µ–Ω–∞

### –ó–∞–ø—Ä–æ—Å –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞ –∫ –ø—Ä–æ–∫—Å–∏

```json
{
  "protocol": "http" | "https",
  "address": "string",
  "port": "number",
  "path": "string",
  "method": "GET" | "POST" | "PUT" | "DELETE",
  "headers": { "key": "value" },
  "body": "object" | null
}
```

### –û—Ç–≤–µ—Ç—ã –æ—Ç –ø—Ä–æ–∫—Å–∏ –∫ –∫–ª–∏–µ–Ω—Ç—É

**–£—Å–ø–µ—à–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:**
```json
{
  "type": "connected",
  "payload": { "status": 200 }
}
```

**–î–∞–Ω–Ω—ã–µ –æ—Ç SSE-—Å–µ—Ä–≤–µ—Ä–∞:**
```json
{
  "type": "data",
  "payload": "—Å—Ç—Ä–æ–∫–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ –ø–æ–ª—è data: SSE-—Å–æ–±—ã—Ç–∏—è"
}
```

**–ü—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö (—ç—Ö–æ-–æ—Ç–≤–µ—Ç):**
```json
{
  "type": "data",
  "payload": "{\"type\":\"echo\",\"originalMessage\":\"Hello Server! #1\",\"timestamp\":\"2024-01-01T12:00:00.000Z\",\"response\":\"Echo 1/3: Hello Server! #1\",\"sequence\":1}"
}
```

**–û—à–∏–±–∫–∞:**
```json
{
  "type": "error",
  "payload": { "message": "–¢–µ–∫—Å—Ç –æ—à–∏–±–∫–∏" }
}
```

**–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø–æ—Ç–æ–∫–∞:**
```json
{
  "type": "closed",
  "payload": { "reason": "Server closed connection normally." }
}
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –≤—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:

1. **SSE –°–µ—Ä–≤–µ—Ä** - –ª–æ–≥–∏ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π –∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —ç—Ö–æ-–æ—Ç–≤–µ—Ç–æ–≤
2. **–ü—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä** - –ª–æ–≥–∏ WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π, HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ SSE –ø–æ—Ç–æ–∫–∞
3. **–ö–ª–∏–µ–Ω—Ç** - –æ—Ç–ø—Ä–∞–≤–∫—É 5 —Å–æ–æ–±—â–µ–Ω–∏–π —Å –ø–∞—É–∑–æ–π 1 —Å–µ–∫—É–Ω–¥–∞ –º–µ–∂–¥—É –ø–æ–ª—É—á–µ–Ω–∏–µ–º –æ—Ç–≤–µ—Ç–∞ –∏ —Å–ª–µ–¥—É—é—â–µ–π –æ—Ç–ø—Ä–∞–≤–∫–æ–π

### –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã

–ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç 5 —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ, —Å–µ—Ä–≤–µ—Ä –æ—Ç–≤–µ—á–∞–µ—Ç 3 —ç—Ö–æ-—Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ –Ω–∞ –∫–∞–∂–¥–æ–µ:

```
‚úÖ Connected to Proxy WebSocket
üìã –ë—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ 5 —Å–æ–æ–±—â–µ–Ω–∏–π
üì§ #1: Hello Server! #1
‚úÖ Connected to server (200)
üì• Echo: Echo 1/3: Hello Server! #1
üì• Echo: Echo 2/3: Hello Server! #1
üì• Echo: Echo 3/3: Hello Server! #1
üîö Server closed: Server closed connection normally.
üì§ #2: Hello Server! #2
... (–ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è –¥–ª—è –≤—Å–µ—Ö 5 —Å–æ–æ–±—â–µ–Ω–∏–π)
‚úÖ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ 5 —Å–æ–æ–±—â–µ–Ω–∏–π. –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ç–µ—Å—Ç–∞.
```

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

- **–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞**: –ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–ª–µ–¥—É—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–ª–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
- **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ SSE —Å–æ–æ–±—â–µ–Ω–∏—è**: –°–µ—Ä–≤–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç 3 —ç—Ö–æ-–æ—Ç–≤–µ—Ç–∞ —Å –ø–∞—É–∑–æ–π 1 —Å–µ–∫—É–Ω–¥–∞ –º–µ–∂–¥—É –Ω–∏–º–∏
- **–¢–∞–π–º–∞—É—Ç –ø—Ä–æ–∫—Å–∏**: –ü—Ä–æ–∫—Å–∏ –∏–º–µ–µ—Ç 5-—Å–µ–∫—É–Ω–¥–Ω—ã–π —Ç–∞–π–º–∞—É—Ç –¥–ª—è —á—Ç–µ–Ω–∏—è SSE –ø–æ—Ç–æ–∫–∞
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ**: –ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ 5 —Å–æ–æ–±—â–µ–Ω–∏–π –∫–ª–∏–µ–Ω—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ

## –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

- **SSE –°–µ—Ä–≤–µ—Ä**: `localhost:8081`
- **–ü—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä**: `localhost:3001`
- **WebSocket endpoint**: `ws://localhost:3001/proxy`
- **–°–æ–æ–±—â–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞**: "Hello Server!"
- **–û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞**: 3 —ç—Ö–æ-—Å–æ–æ–±—â–µ–Ω–∏—è —Å –ø–∞—É–∑–æ–π 1 —Å–µ–∫—É–Ω–¥–∞
- **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π**: 5
- **–ü–∞—É–∑–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏**: 1 —Å–µ–∫—É–Ω–¥–∞ –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–∞

–í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –≤ —Ñ–∞–π–ª–µ `settings.json`.

## –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- –ù–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏/–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- –ù–µ—Ç –±–µ–ª–æ–≥–æ —Å–ø–∏—Å–∫–∞ –∞–¥—Ä–µ—Å–æ–≤
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ–ª–µ `data:` –≤ SSE
- –ù–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏
- –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ (–æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å –≤ –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏)

## –õ–∏—Ü–µ–Ω–∑–∏—è

ISC

## –ê–≤—Ç–æ—Ä

–ü—Ä–æ–µ–∫—Ç —Å–æ–∑–¥–∞–Ω –¥–ª—è WebSocket to SSE –ø—Ä–æ–∫—Å–∏.
